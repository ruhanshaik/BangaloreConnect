<%- include('partials/header') %>

    <div class="dashboard">
        <div class="container">
            <div class="dashboard-header">
                <div>
                    <h1>Admin Dashboard</h1>
                    <p>Welcome back, <%= username %></p>
                </div>
                <div>
                    <a href="/admin/post-job" class="btn btn-apply" style="margin-right: 1rem;">
                        <i class="fas fa-plus"></i> Post New Job
                    </a>
                    <a href="/admin/logout" class="btn btn-outline">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </div>
            
            <% if (typeof success !== 'undefined') { %>
                <div class="success-message" style="background: var(--success); color: white; padding: 1rem; border-radius: var(--radius); margin-bottom: 2rem;">
                    <i class="fas fa-check-circle"></i> <%= success %>
                </div>
            <% } %>
            
            <% if (typeof error !== 'undefined') { %>
                <div class="error-message" style="margin-bottom: 2rem;">
                    <i class="fas fa-exclamation-circle"></i> <%= error %>
                </div>
            <% } %>
            
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-icon jobs">
                        <i class="fas fa-briefcase"></i>
                    </div>
                    <div class="stat-content">
                        <h3><%= totalJobs || '0' %></h3>
                        <p>Active Jobs</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon applications">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="stat-content">
                        <h3>4</h3>
                        <p>Team Members</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon companies">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="stat-content">
                        <h3><%= Math.ceil((totalJobs || 0)/2) %></h3>
                        <p>Companies</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon users">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3>10K+</h3>
                        <p>Users</p>
                    </div>
                </div>
            </div>
            
            <!-- Recent Jobs Section -->
            <% if (recentJobs && recentJobs.length > 0) { %>
                <div class="job-detail-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2>Recent Jobs</h2>
                        <a href="/" class="btn btn-outline" target="_blank">
                            <i class="fas fa-eye"></i> View Website
                        </a>
                    </div>
                    
                    <div class="jobs-grid" style="grid-template-columns: 1fr;">
                        <% recentJobs.forEach(job => { %>
                            <div class="job-card">
                                <div class="job-header">
                                    <div class="job-badge">
                                        <span class="badge <%= job.type.toLowerCase().replace('-', '') %>"><%= job.type %></span>
                                        <span class="badge experience"><%= job.experience %></span>
                                    </div>
                                    <div>
                                        <span class="meta-item">
                                            <i class="fas fa-calendar"></i>
                                            <% 
                                                // Format the date
                                                const date = new Date(job.postedDate);
                                                const now = new Date();
                                                const diffTime = Math.abs(now - date);
                                                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                                                
                                                if (diffDays === 1) { 
                                            %>Today<%
                                                } else if (diffDays <= 7) { 
                                            %><%= diffDays %> days ago<%
                                                } else { 
                                            %><%= date.toLocaleDateString('en-IN', { 
                                                    day: 'numeric', 
                                                    month: 'short', 
                                                    year: 'numeric' 
                                                }) %><%
                                                } 
                                            %>
                                        </span>
                                    </div>
                                </div>
                                
                                <h3 class="job-title"><%= job.title %></h3>
                                <p class="job-company">
                                    <i class="fas fa-building"></i>
                                    <%= job.company %>
                                </p>
                                
                                <div class="job-meta">
                                    <span class="meta-item">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <%= job.location %>
                                    </span>
                                    <span class="meta-item">
                                        <i class="fas fa-rupee-sign"></i>
                                        <%= job.salary %>
                                    </span>
                                </div>
                                
                                <p class="job-description">
                                    <% 
                                        const desc = job.shortDescription || '';
                                        if (desc.length > 120) {
                                    %>
                                        <%= desc.substring(0, 120) %>...
                                    <% } else { %>
                                        <%= desc %>
                                    <% } %>
                                </p>
                                
                                <div class="job-actions">
                                    <a href="/job/<%= job.id %>" class="btn btn-outline" target="_blank">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                    <form action="/admin/delete-job/<%= job.id %>" method="POST" style="display: inline;">
                                        <button type="submit" class="btn btn-outline" onclick="return confirm('Are you sure you want to delete this job?')" style="color: var(--danger); border-color: var(--danger);">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                    </form>
                                </div>
                            </div>
                        <% }); %>
                    </div>
                </div>
            <% } else { %>
                <div class="job-detail-card" style="text-align: center; padding: 3rem;">
                    <i class="fas fa-briefcase fa-4x" style="color: var(--light-gray); margin-bottom: 1.5rem;"></i>
                    <h2 style="margin-bottom: 1rem;">No Jobs Posted Yet</h2>
                    <p style="color: var(--gray); margin-bottom: 2rem;">Start by posting your first job opportunity</p>
                    <a href="/admin/post-job" class="btn btn-apply">
                        <i class="fas fa-plus"></i> Post Your First Job
                    </a>
                </div>
            <% } %>
        </div>
    </div>

<%- include('partials/footer') %>